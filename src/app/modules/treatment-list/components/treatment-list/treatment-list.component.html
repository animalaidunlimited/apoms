    <fieldset class="form-sub-group">

      <mat-spinner *ngIf="showSpinner" style="margin:0 auto;"></mat-spinner>

      <legend class="legend ">{{area.areaName}} - ({{treatmentListArray.controls?.length}})</legend>


      <button type="button" mat-raised-button color="primary" (click)="treatmentLayout()">Treatment layout</button>

      <button type="button" mat-raised-button color="primary" (click)="censusLayout()">Census layout</button>

      <button type="button" mat-mini-fab color="primary" (click)="print()"><mat-icon>local_printshop</mat-icon></button>

      <form [formGroup]="treatmentListForm">


              <table mat-table [dataSource]="patientRecords" formArrayName="treatmentList">


                <tr mat-header-row *matHeaderRowDef="(displayedColumns | async)"></tr>
                <tr mat-row *matRowDef="let row; let i = index; columns: (displayedColumns | async);"></tr>

                <ng-container matColumnDef="index">
                  <th mat-header-cell *matHeaderCellDef class="small-column start"> Count </th>
                  <td mat-cell *matCellDef="let index = index" class="small-column start"> {{index + 1}} </td>
                </ng-container>

                <ng-container matColumnDef="complete">
                  <th mat-header-cell *matHeaderCellDef class="center-columnm"> Treated </th>
                  <td mat-cell *matCellDef="let row;" class="small-column">

                    <mat-chip-list>
                    <mat-chip #treatedChip="matChip" (click)="toggleTreatment(row)">
                      <mat-icon [class.is-hidden]="!row.treatedToday" class="complete">check_circle</mat-icon>
                    </mat-chip>
                  </mat-chip-list>

                  </td>
                </ng-container>

                <!--DYNAMIC FIELDS START-->

                <ng-container *ngFor="let column of ( filteredColumns | async)">

                  <!-- Column definitions -->
                  <ng-container [matColumnDef]="column.name">

                    <!--<th mat-header-cell *matHeaderCellDef> {{column.name}} </th>
                    <td mat-cell *matCellDef="let row; let index = index"  [formGroupName]="index">
-->

                      <th mat-header-cell *matHeaderCellDef
                      [class.small-column]="column.name !== 'Treatment priority'"
                      [class.center-columnm]="column.name !== 'Tag number'"
                      [class.width-175]="column.name == 'Treatment priority'">
                        {{column.abbreviation || column.name}}
                      </th>

                      <td mat-cell *matCellDef="let row; let index = index;"
                      [formGroupName]="index"
                      [class.small-column]="column.name !== 'Treatment priority'"
                      [class.center-columnm]="column.name !== 'Treatment priority' && column.name !== 'Tag number'"
                      [class.width-175]="column.name == 'Treatment priority'"
                      [class.link]="column.name === 'Tag number'">

                      <div *ngIf="column.type === 'text'">
                        {{row.get(column.name).value}}
                      </div>


                      <div *ngIf="column.type === 'select'" class="width-175 start">
                        <mat-form-field>
                        <mat-select
                        [formControlName]="column.name"
                        (selectionChange)="priorityChanged(row, $event)">
                            <mat-option>N/A</mat-option>
                            <mat-option [value]="2">High</mat-option>
                            <mat-option [value]="3">Medium</mat-option>
                            <mat-option [value]="4">Low</mat-option>
                        </mat-select>
                      </mat-form-field>
                      </div>

                      <div *ngIf="column.type === 'button'">

                        <button mat-icon-button color="primary" style="cursor:pointer;" aria-label="Quick update dates"
                        (click)="quickUpdate(row.PatientId, row['Tag number'])">
                            <mat-icon>event</mat-icon>
                        </button>

                      </div>

                      <div *ngIf="column.type === 'checkbox'" fxLayout="column" fxLayoutAlign="center center">

                          <mat-radio-button  [checked]="column?.areaId === treatmentListArray.at(index).get('Moved to')?.value" (change)="areaChanged(column?.areaId, index)"></mat-radio-button>

                      </div>

                    </td>
                  </ng-container>

                </ng-container>

                <!--DYNAMIC FIELDS END-->

                <ng-container matColumnDef="Other">
                  <th mat-header-cell *matHeaderCellDef> Other </th>

                  <td mat-cell *matCellDef="let row; let index = index;"
                  [formGroupName]="index">

                  <div fxLayout="row" fxLayoutAlign="space-between center">

                      <mat-form-field>
                      <mat-select
                      formControlName="Moved to"
                      (selectionChange)="areaChanged($event?.value, index)">

                        <mat-option>N/A</mat-option>
                        <mat-option [value]="area.areaId" *ngFor="let area of otherAreas">{{ area.areaName }}</mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-spinner *ngIf="row.get('saving')?.value" class="saved-spinner" [diameter]="24"></mat-spinner>
                    <mat-icon *ngIf="row.get('saved')?.value" class="saved-icon">check_circle</mat-icon>
                    <mat-icon *ngIf="!row.get('saved')?.value && !row.get('saving')?.value" class="saved-icon"></mat-icon>

                  </div>

                  </td>

                </ng-container>


            </table>


    </form>

    </fieldset>


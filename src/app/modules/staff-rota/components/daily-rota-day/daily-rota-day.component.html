

<form [formGroup]="rotaDayForm">  

  <table  mat-table [dataSource]="dataSource" class="day-rota-table" formArrayName="rotaDayAssignments">    

        <ng-container matColumnDef="rotationArea">
          <th mat-header-cell *matHeaderCellDef class="first-column">
            
          </th>
          <td mat-cell *matCellDef="let element"
          class="area-header"
          [attr.rowspan]="element.get('areaRowSpan')?.value"
          [style.display]="element.get('areaRowSpan')?.value !== 0  ? '' : 'none'"
          [ngStyle]="{backgroundColor: element.get('rotationAreaColour')?.value}"
          
          > {{element.get('rotationArea')?.value}} </td>
        </ng-container>
      
        <ng-container matColumnDef="rotationRole">
          <th mat-header-cell *matHeaderCellDef> Rotation Role </th>
          <td mat-cell *matCellDef="let element"> {{element.get('rotationRole')?.value}} </td>
        </ng-container>
      
        <ng-container matColumnDef="userId">
          <th mat-header-cell *matHeaderCellDef style="max-width: 200px;"> Who </th>
          <td mat-cell *matCellDef="let element; let i = index;" style="max-width: 200px;"> 
          
            <mat-form-field [formGroupName]="i">
    
              <input matInput
              type="text"
              class="user-input"
              formControlName="userId"              
              (focus)="setFilteredUsers(element.get('userId'))"
              [matAutocomplete]="auto">
    
              <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                <mat-option>N/A</mat-option>
                <mat-option *ngFor="let user of (filteredUsers | async)" [value]="user.userId">
                  {{ user.employeeNumber + ' - ' + user.firstName }}
                </mat-option>
              </mat-autocomplete> 
    
    
            </mat-form-field>
          
          </td>
        </ng-container>
      
        <ng-container matColumnDef="plannedStartTime">
          <th mat-header-cell *matHeaderCellDef> Start time </th>
          <td mat-cell *matCellDef="let element"> {{element.get('plannedShiftStartTime')?.value}} </td>
        </ng-container>
      
        <ng-container matColumnDef="plannedEndTime">
          <th mat-header-cell *matHeaderCellDef> End time </th>
          <td mat-cell *matCellDef="let element"> {{element.get('plannedShiftEndTime')?.value}} </td>
        </ng-container>
      
        <ng-container matColumnDef="actualStartTime">
          <th mat-header-cell *matHeaderCellDef> Real start </th>
          <td mat-cell *matCellDef="let element; let i = index;">
            <mat-form-field [formGroupName]="i" class="time-field">
              <input matInput autocomplete="off" formControlName="actualShiftStartTime" type="time"/>  
            </mat-form-field>  
          </td>
        </ng-container>
      
        <ng-container matColumnDef="actualEndTime">
          <th mat-header-cell *matHeaderCellDef> Real end </th>
          <td mat-cell *matCellDef="let element; let i = index;"> 
            <mat-form-field [formGroupName]="i" class="time-field">
              <input matInput autocomplete="off" formControlName="actualShiftEndTime" type="time"/>  
            </mat-form-field>
          </td>
        </ng-container>
      
        <ng-container matColumnDef="notes">
          <th mat-header-cell *matHeaderCellDef> Notes </th>
          <td mat-cell *matCellDef="let element; let i = index;"> 
            <mat-form-field [formGroupName]="i" class="notes-field">
              <input matInput autocomplete="off" formControlName="notes" type="text"/>  
            </mat-form-field>
           </td>
        </ng-container>


    
  
    <tr mat-header-row *matHeaderRowDef="displayedColumns sticky: true;"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns; let i = dataIndex" ></tr>
  </table>


</form>
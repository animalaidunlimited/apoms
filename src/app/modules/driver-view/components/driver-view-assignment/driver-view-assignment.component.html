<div *ngIf='driverViewAssignments | async' class="actionStatusWrapper">
    <fieldset class="form-sub-group" *ngIf="(showCompleteFlag && actionStatus==='Complete') || (!showCompleteFlag && actionStatus!=='Complete')">
        <legend class="legend">{{actionStatus}}</legend>

        <div *ngFor="let assignments of driverViewAssignments | async" >
            
            <div class="caseDivContainer" fxLayout="column" fxLayoutAlign='start'> 

                <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start end'>

                    <div *ngIf="assignments.ambulanceAction === 'Rescue'" class="emergencyDetailsCode" [ngClass]="{
                        'grey' : assignments.emergencyCodeId == 4,
                        'red' : assignments.emergencyCodeId == 1,
                        'green' : assignments.emergencyCodeId == 2,
                        'yellow' : assignments.emergencyCodeId == 3}">
                    </div>

                    <div *ngIf="assignments.ambulanceAction === 'STRelease' || assignments.ambulanceAction ==='StreetTreat'" class="emergencyDetailsCode" [ngClass]="{
                        'grey' : assignments.streetTreatPriorityId == 4,
                        'red' : assignments.streetTreatPriorityId == 1,
                        'green' : assignments.streetTreatPriorityId == 2,
                        'yellow' : assignments.streetTreatPriorityId == 3}">
                    </div>


                    <p>EmNo:{{assignments.emergencyNumber}}</p>

                    <div fxLayout='row wrap' fxLayoutAlign='start'>
                        <p>AnimalType: {{assignments.patients[0].animalType}}</p> 
                        <p class="countWrapper" *ngIf="assignments.patients.length > 1">+{{assignments.patients.length - 1}}</p>
                    </div>

                    <app-driver-view-icons class="caseIconWrapper" [driverViewAssignment]="assignments">

                    </app-driver-view-icons>

                </div>

                <div>
                    <p>Address: {{assignments.location}}</p>
                </div>

                <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start'>

                 

                    <div fxLayout='row'>
                        <p>Main Problem:</p>
                        <p *ngIf="assignments.ambulanceAction === 'STRelease' || assignments.ambulanceAction ==='StreetTreat'"> {{assignments.streetTreatMainProblem}} </p>
                        <div fxLayout='row wrap' fxLayoutAlign='start'>
                            <p *ngIf="assignments.ambulanceAction === 'Rescue' || assignments.ambulanceAction ==='Release'"> {{assignments.patients[0].problems}} </p>
                            <p class="countWrapper" *ngIf="(assignments.ambulanceAction === 'Rescue' || assignments.ambulanceAction ==='Release') && assignments.patients.length > 1">
                                + {{assignments.patients.length - 1}} 
                            </p>
                        </div>
                        
                    </div>

                </div>

                <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'Rescue'">
                    <mat-button-toggle>
                        Arrived
                        <mat-icon *ngIf = "assignments.ambulanceArrivalTime" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Rescued
                        <mat-icon *ngIf = "assignments.rescueTime" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Admitted
                        <mat-icon *ngIf="assignments.patientCallOutcomeId == 1" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                </mat-button-toggle-group>

                <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'Release'">
                    <mat-button-toggle>
                        Pickedup
                        <mat-icon *ngIf = "assignments.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Arrived
                        <mat-icon *ngIf = "assignments.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Complete
                        <mat-icon *ngIf="assignments.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                </mat-button-toggle-group>

                <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'StreetTreat'">
                    <mat-button-toggle>
                        Arrived
                        <mat-icon *ngIf = "assignments.visitBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Complete
                        <mat-icon *ngIf="assignments.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                </mat-button-toggle-group>


                <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'STRelease'">
                    <mat-button-toggle>
                        Pickedup
                        <mat-icon *ngIf = "assignments.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Arrived
                        <mat-icon *ngIf = "assignments.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Released
                        <mat-icon *ngIf="assignments.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                    <mat-button-toggle>
                        Treated
                        <mat-icon *ngIf="assignments.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                    </mat-button-toggle>
                </mat-button-toggle-group>

                <div fxLayout="row-reverse" style="margin:1em 1em 0 0">
                    <div class="actionWrapper" [ngClass]="{
                        'STRelease' : assignments.ambulanceAction === 'STRelease',
                        'StreetTreat' : assignments.ambulanceAction === 'StreetTreat',
                        'Rescue' : assignments.ambulanceAction === 'Rescue',
                        'Release' : assignments.ambulanceAction === 'Release'}">
                        <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'STRelease'">STRelease</p>
                        <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'StreetTreat'">StreetTreat</p>
                        <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'Rescue'">Rescue</p>
                        <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'Release'">Release</p>
                    </div>
                </div>

            </div>

        </div>
    </fieldset>
</div>
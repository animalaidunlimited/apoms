
<div class="contentWrapper" [formGroup]="driverViewDetails">

   <div class="selectionDivWrapper" fxLayout='row wrap' fxLayoutGap = '30px' fxLauoutAlign='start'>
        <mat-form-field class="dateField">
            <mat-label>Date</mat-label>
            <input matInput type="datetime-local" formControlName="assignmentDate" name = "AssignmentDate">
        </mat-form-field>

        <mat-form-field>
            <mat-label>Secondary Rescuer</mat-label>
                <mat-select formControlName="rescuer1Id">
                <mat-option>N/A</mat-option>
                    <mat-option *ngFor="let rescuer of rescuers$ | async" [value]="rescuer.UserId">
                    {{rescuer.FirstName}}
                </mat-option>
            </mat-select>
        </mat-form-field>
   </div>

    <div *ngIf='inProgressStatusList'>
        <fieldset class="form-sub-group">
            <legend class="legend">In Progress</legend>
    
            <div *ngFor="let progressAssignment of inProgressStatusList" >
                
                <div class="caseDivContainer" fxLayout="column" fxLayoutAlign='start'> 

                    <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start end'>

                        <div *ngIf="progressAssignment.ambulanceAction === 'Rescue'" class="emergencyDetailsCode" [ngClass]="{
                            'grey' : progressAssignment.emergencyCodeId == 4,
                            'red' : progressAssignment.emergencyCodeId == 1,
                            'green' : progressAssignment.emergencyCodeId == 2,
                            'yellow' : progressAssignment.emergencyCodeId == 3}">
                        </div>

                        <div *ngIf="progressAssignment.ambulanceAction === 'STRelease' || progressAssignment.ambulanceAction ==='StreetTreat'" class="emergencyDetailsCode" [ngClass]="{
                            'grey' : progressAssignment.streetTreatPriorityId == 4,
                            'red' : progressAssignment.streetTreatPriorityId == 1,
                            'green' : progressAssignment.streetTreatPriorityId == 2,
                            'yellow' : progressAssignment.streetTreatPriorityId == 3}">
                        </div>


                        <p>EmNo:{{progressAssignment.emergencyNumber}}</p>

                        <div fxLayout='row wrap' fxLayoutAlign='start'>
                            <p>AnimalType: {{progressAssignment.patients[0].animalType}}</p> 
                            <p class="countWrapper" *ngIf="progressAssignment.patients.length > 1">+{{progressAssignment.patients.length - 1}}</p>
                        </div>

                    </div>

                    <div>
                        <p>Address: {{progressAssignment.location}}</p>
                    </div>

                    <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start'>

                        <!-- <div fxLayout='row'>
                            <p>Description: </p>
                            <p style="min-width: 30px;">{{progressAssignment.animalDescription}}</p>
                        </div> -->
    
                        <div fxLayout='row'>
                            <p>Main Problem:</p>
                            <p *ngIf="progressAssignment.ambulanceAction === 'STRelease' || progressAssignment.ambulanceAction ==='StreetTreat'"> {{progressAssignment.streetTreatMainProblem}} </p>
                            <div fxLayout='row wrap' fxLayoutAlign='start'>
                                <p *ngIf="progressAssignment.ambulanceAction === 'Rescue' || progressAssignment.ambulanceAction ==='Release'"> {{progressAssignment.patients[0].problems}} </p>
                                <p class="countWrapper" *ngIf="(progressAssignment.ambulanceAction === 'Rescue' || progressAssignment.ambulanceAction ==='Release') && progressAssignment.patients.length > 1">
                                    + {{progressAssignment.patients.length - 1}} 
                                </p>
                            </div>
                            
                        </div>

                    </div>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="progressAssignment.ambulanceAction === 'Rescue'">
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "progressAssignment.ambulanceArrivalTime" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Rescued
                            <mat-icon *ngIf = "progressAssignment.rescueTime" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Admitted
                            <mat-icon *ngIf="progressAssignment.patientCallOutcomeId == 1" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="progressAssignment.ambulanceAction === 'Release'">
                        <mat-button-toggle>
                            Pickedup
                            <mat-icon *ngIf = "progressAssignment.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "progressAssignment.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Complete
                            <mat-icon *ngIf="progressAssignment.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="progressAssignment.ambulanceAction === 'StreetTreat'">
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "progressAssignment.visitBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Complete
                            <mat-icon *ngIf="progressAssignment.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>


                    <mat-button-toggle-group class="toggleDiv" *ngIf="progressAssignment.ambulanceAction === 'STRelease'">
                        <mat-button-toggle>
                            Pickedup
                            <mat-icon *ngIf = "progressAssignment.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "progressAssignment.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Released
                            <mat-icon *ngIf="progressAssignment.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Treated
                            <mat-icon *ngIf="progressAssignment.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <div fxLayout="row-reverse" style="margin:1em 1em 0 0">
                        <div class="actionWrapper" [ngClass]="{
                            'STRelease' : progressAssignment.ambulanceAction === 'STRelease',
                            'StreetTreat' : progressAssignment.ambulanceAction === 'StreetTreat',
                            'Rescue' : progressAssignment.ambulanceAction === 'Rescue',
                            'Release' : progressAssignment.ambulanceAction === 'Release'}">
                            <p class="textWrapper" *ngIf="progressAssignment.ambulanceAction === 'STRelease'">STRelease</p>
                            <p class="textWrapper" *ngIf="progressAssignment.ambulanceAction === 'StreetTreat'">StreetTreat</p>
                            <p class="textWrapper" *ngIf="progressAssignment.ambulanceAction === 'Rescue'">Rescue</p>
                            <p class="textWrapper" *ngIf="progressAssignment.ambulanceAction === 'Release'">Release</p>
                        </div>
                    </div>

                </div>

            </div>
        </fieldset>
    </div>

    <div *ngIf='inAmbulaneStatusList'>
        <fieldset class="form-sub-group">
            <legend class="legend">In Ambulance</legend>
    
            <div *ngFor="let ambulanceAssignment of inAmbulaneStatusList" >
                
                <div class="caseDivContainer" fxLayout="column" fxLayoutAlign='start'> 

                    <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start end'>

                        <div *ngIf="ambulanceAssignment.ambulanceAction === 'Rescue'" class="emergencyDetailsCode" [ngClass]="{
                            'grey' : ambulanceAssignment.emergencyCodeId == 4,
                            'red' : ambulanceAssignment.emergencyCodeId == 1,
                            'green' : ambulanceAssignment.emergencyCodeId == 2,
                            'yellow' : ambulanceAssignment.emergencyCodeId == 3}">
                        </div>

                        <div *ngIf="ambulanceAssignment.ambulanceAction=='STRelease' || ambulanceAssignment.ambulanceAction=='StreetTreat'" class="emergencyDetailsCode" [ngClass]="{
                            'grey' : ambulanceAssignment.streetTreatPriorityId == 4,
                            'red' : ambulanceAssignment.streetTreatPriorityId == 1,
                            'green' : ambulanceAssignment.streetTreatPriorityId == 2,
                            'yellow' : ambulanceAssignment.streetTreatPriorityId == 3}">
                        </div>

                        <p>EmNo:{{ambulanceAssignment.emergencyNumber}}</p>

                        <div fxLayout='row wrap' fxLayoutAlign='start'>
                            <p>AnimalType: {{ambulanceAssignment.patients[0].animalType}}</p>  
                            <p class="countWrapper" *ngIf="ambulanceAssignment.patients.length > 1">+{{ambulanceAssignment.patients.length - 1}}</p>
                        </div>
                       

                    </div>

                    <div>
                        <p>Address: {{ambulanceAssignment.location}}</p>
                    </div>

                    <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start'>

                        <!-- <div fxLayout='row'>
                            <p>Description: </p>
                            <p style="min-width: 30px;">{{ambulanceAssignment.animalDescription}}</p>
                        </div> -->
    
                        <div fxLayout='row'>
                            <p>Main Problem:</p>
                            <p *ngIf="ambulanceAssignment.ambulanceAction === 'STRelease' || ambulanceAssignment.ambulanceAction ==='StreetTreat'">{{ambulanceAssignment.streetTreatMainProblem}} </p>
                            <div fxLayout='row wrap' fxLayoutAlign='start'>
                                <p *ngIf="ambulanceAssignment.ambulanceAction === 'Rescue' || ambulanceAssignment.ambulanceAction ==='Release'"> {{ambulanceAssignment.patients[0].problems}} </p>
                                <p class="countWrapper" *ngIf="(ambulanceAssignment.ambulanceAction === 'Rescue' || ambulanceAssignment.ambulanceAction ==='Release') && ambulanceAssignment.patients.length > 1">
                                    + {{ambulanceAssignment.patients.length - 1}} 
                                </p>
                            </div>
                           
                        </div>

                    </div>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="ambulanceAssignment.ambulanceAction === 'Rescue'">
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "ambulanceAssignment.ambulanceArrivalTime" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Rescued
                            <mat-icon *ngIf = "ambulanceAssignment.rescueTime" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Admitted
                            <mat-icon *ngIf="ambulanceAssignment.patientCallOutcomeId == 1" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="ambulanceAssignment.ambulanceAction === 'Release'">
                        <mat-button-toggle>
                            Pickedup
                            <mat-icon *ngIf = "ambulanceAssignment.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "ambulanceAssignment.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Complete
                            <mat-icon *ngIf="ambulanceAssignment.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="ambulanceAssignment.ambulanceAction === 'StreetTreat'">
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "ambulanceAssignment.visitBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Complete
                            <mat-icon *ngIf="ambulanceAssignment.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>


                    <mat-button-toggle-group class="toggleDiv" *ngIf="ambulanceAssignment.ambulanceAction === 'STRelease'">
                        <mat-button-toggle>
                            Pickedup
                            <mat-icon *ngIf = "ambulanceAssignment.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "ambulanceAssignment.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>

                        <mat-button-toggle>
                            Released
                            <mat-icon *ngIf="ambulanceAssignment.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>

                        <mat-button-toggle>
                            Treated
                            <mat-icon *ngIf="ambulanceAssignment.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <div fxLayout="row-reverse" style="margin:1em 1em 0 0">
                        <div class="actionWrapper" [ngClass]="{
                            'STRelease' : ambulanceAssignment.ambulanceAction === 'STRelease',
                            'StreetTreat' : ambulanceAssignment.ambulanceAction === 'StreetTreat',
                            'Rescue' : ambulanceAssignment.ambulanceAction === 'Rescue',
                            'Release' : ambulanceAssignment.ambulanceAction === 'Release'}">
                            <p class="textWrapper" *ngIf="ambulanceAssignment.ambulanceAction === 'STRelease'">STRelease</p>
                            <p class="textWrapper" *ngIf="ambulanceAssignment.ambulanceAction === 'StreetTreat'">StreetTreat</p>
                            <p class="textWrapper" *ngIf="ambulanceAssignment.ambulanceAction === 'Rescue'">Rescue</p>
                            <p class="textWrapper" *ngIf="ambulanceAssignment.ambulanceAction === 'Release'">Release</p>
                        </div>
                    </div>

                </div>

            </div>
        </fieldset>
    </div>

    <div *ngIf='assignedList'>
        <fieldset class="form-sub-group">
            <legend class="legend">Assigned</legend>
    
            <div *ngFor="let assignments of assignedList" >
                
                <div class="caseDivContainer" fxLayout="column" fxLayoutAlign='start'> 

                    <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start end'>

                        <div *ngIf="assignments.ambulanceAction=='Rescue'" class="emergencyDetailsCode" [ngClass]="{
                            'grey' : assignments.streetTreatPriorityId == 4,
                            'red' : assignments.emergencyCodeId == 1,
                            'green' : assignments.emergencyCodeId == 2,
                            'yellow' : assignments.emergencyCodeId == 3}">
                        </div>

                        <div *ngIf="assignments.ambulanceAction=='STRelease' || assignments.ambulanceAction=='StreetTreat'" class="emergencyDetailsCode" [ngClass]="{
                            'grey' : assignments.streetTreatPriorityId == 4,
                            'red' : assignments.streetTreatPriorityId == 1,
                            'green' : assignments.streetTreatPriorityId == 2,
                            'yellow' : assignments.streetTreatPriorityId == 3}">
                        </div>

                        <p>EmNo:{{assignments.emergencyNumber}}</p>
                        <div fxLayout='row wrap' fxLayoutAlign='start'>
                            <p>AnimalType: {{assignments.patients[0].animalType}}</p>
                            <p class="countWrapper" *ngIf="assignments.patients.length > 1">+{{assignments.patients.length - 1}}</p>
    
                        </div>
                       

                    </div>

                    <div>
                        <p>Address: {{assignments.location}}</p>
                    </div>

                    <div fxLayout='row wrap' fxLayoutGap='20px' fxLayoutAlign='start'>

                        <!-- <div fxLayout='row'>
                            <p>Description: </p>
                            <p style="min-width: 30px;">{{assignments.animalDescription}}</p>
                        </div> -->
    
                        <div fxLayout='row'>
                            <p>Main Problem:</p>
                            <p *ngIf="assignments.ambulanceAction === 'STRelease' || assignments.ambulanceAction ==='StreetTreat'"> {{assignments.streetTreatMainProblem}} </p>
                            <div fxLayout='row wrap' fxLayoutAlign='start'>
                                <p *ngIf="assignments.ambulanceAction === 'Rescue' || assignments.ambulanceAction ==='Release'"> {{assignments.patients[0].problems}} </p>
                                <p class="countWrapper" *ngIf="assignments.ambulanceAction === 'Rescue' && assignments.patients.length > 1">
                                    + {{assignments.patients.length - 1}} 
                                </p>
                            </div>
                           
                        </div>

                    </div>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'Rescue'">
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "assignments.ambulanceArrivalTime" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Rescued
                            <mat-icon *ngIf = "assignments.rescueTime" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Admitted
                            <mat-icon *ngIf="assignments.patientCallOutcomeId == 1" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'Release'">
                        <mat-button-toggle>
                            Pickedup
                            <mat-icon *ngIf = "assignments.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "assignments.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Complete
                            <mat-icon *ngIf="assignments.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'StreetTreat'">
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "assignments.visitBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Complete
                            <mat-icon *ngIf="assignments.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>


                    <mat-button-toggle-group class="toggleDiv" *ngIf="assignments.ambulanceAction === 'STRelease'">
                        <mat-button-toggle>
                            Pickedup
                            <mat-icon *ngIf = "assignments.releasePickupDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Arrived
                            <mat-icon *ngIf = "assignments.releaseBeginDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Released
                            <mat-icon *ngIf="assignments.releaseEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle>
                            Treated
                            <mat-icon *ngIf="assignments.visitEndDate" class="toggleButtonColor">check_circle</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>

                    <div fxLayout="row-reverse" style="margin:1em 1em 0 0">
                        <div class="actionWrapper" [ngClass]="{
                            'STRelease' : assignments.ambulanceAction === 'STRelease',
                            'StreetTreat' : assignments.ambulanceAction === 'StreetTreat',
                            'Rescue' : assignments.ambulanceAction === 'Rescue',
                            'Release' : assignments.ambulanceAction === 'Release'}">
                            <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'STRelease'">STRelease</p>
                            <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'StreetTreat'">StreetTreat</p>
                            <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'Rescue'">Rescue</p>
                            <p class="textWrapper" *ngIf="assignments.ambulanceAction === 'Release'">Release</p>
                        </div>
                    </div>

                </div>

            </div>
        </fieldset>
    </div>

    <mat-toolbar-row class="horizontalTab">

        <div fxLayout='column' class="iconDiv">
            <mat-icon aria-label="Complete" style="font-size: 30px;">swap_horizontal_circle</mat-icon>
            <p class="iconText">Log milage</p>
        </div>


        <div fxLayout='column' class="iconDiv">
            <mat-icon aria-label="Complete" style="font-size: 28px;">headset_mic</mat-icon>
            <p class="iconText">Call desk</p>
        </div>

        <div fxLayout='column' class="iconDiv">
            <mat-icon aria-label="Complete" style="font-size: 30px;">location_on</mat-icon>
            <p class="iconText">Map</p>
        </div>

        <div fxLayout='column' class="iconDiv" (click)='changeRoute()'>
            <mat-icon aria-label="Complete" style="font-size: 30px;">check_circle</mat-icon>
            <p class="iconText">Complete</p>
        </div>
    </mat-toolbar-row>
</div>
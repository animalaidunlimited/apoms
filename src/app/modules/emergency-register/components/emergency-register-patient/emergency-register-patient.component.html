<div [formGroup]="patientForm" class="patientForm" fxLayoutGap="20px" fxLayout.lt-md="row wrap" fxLayout="row wrap" fxLayoutAlign="flex-start flex-end" >

    <mat-form-field fxFlexOrder.gt-sm="1">
        <input tabindex="8" #animalTypeInput type="text" placeholder="Species"
        matInput formControlName="animalType" [matAutocomplete]="animalAuto" [errorStateMatcher]="errorMatcher"
        (keydown.Tab)="isSpeciesBlank($event)" (focus)="animalTypeChangessub()" (focusout)="animalTypeChangesUnsub()">

        <mat-autocomplete autoActiveFirstOption #animalAuto="matAutocomplete" (optionSelected)="animalSelected($event)">

          <mat-option *ngFor="let animal of filteredAnimalTypes$ | async" [value]="animal">
            {{ animal.AnimalType }}
          </mat-option>

        </mat-autocomplete>

    </mat-form-field>
    <mat-form-field fxFlex.gt-md="1 1 100" fxFlexOrder.gt-sm="3" ngStyle.lt-md="min-width: 86%;" fxFlexOrder.lt-md="1"  >
        <mat-chip-list #chipList [disabled]="animalType.value === ''" (click)="isSpeciesBlank($event)" required>
          <mat-chip
            *ngFor="let problem of problemsArray?.value"
            style="margin-right: 5px"
            [selectable]="selectable"
            [removable]="removable"
            (removed)="remove(problem.problemId)">
            {{problem.problem}}
            <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
          </mat-chip>
          <input
            placeholder="Main problem(s)"
            #problemRef
            [formControl]="problemInput"
            [matAutocomplete]="problemAuto"
            [matChipInputFor]="chipList"
            tabindex="9"
            (focusout)="checkMainProblem()">
        </mat-chip-list>

        <mat-autocomplete  autoActiveFirstOption #problemAuto="matAutocomplete"  (optionSelected)="updatePatientProblemArray($event)">
          <mat-option *ngFor="let problem of (filteredProblems$ | async)" [value]="problem.ProblemId">
            {{problem.Problem}}
          </mat-option>
        </mat-autocomplete>

    </mat-form-field>

    <mat-form-field fxFlexOrder.gt-sm="2">
        <mat-label>Tag number</mat-label>
        <input tabindex="20" matInput #tagNumber formControlName="tagNumber" [errorStateMatcher]="errorMatcher">
        <mat-error *ngIf="patientForm.get('tagNumber')?.hasError('tagNumberTaken')">
          The tag number already exists.
        </mat-error>
    </mat-form-field>

    <div style="width: 90%;" fxLayout="row wrap" fxFlexOrder.lt-md="4" fxLayoutGap="10px" fxFlexOrder.gt-sm="4">
      <emergency-case-outcome class="patientOutcomeWrapper" [patientForm]="patientForm"></emergency-case-outcome>

      <div *ngIf="patientForm.get('isAdmission')?.value" class="admissionAreaDivWrapper">
        <mat-form-field class="admissionAreaWrapper">
          <mat-label>Admission area</mat-label>
          <mat-select formControlName="admissionArea" [errorStateMatcher]="errorMatcher">
            <mat-option *ngFor="let areaName of treatmentAreaNames$ | async" [value]="areaName.areaId">
              {{areaName.areaName}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>



    <div class="patients_icons" fxFlexOrder.lt-md="6" fxFlexOrder.gt-sm="6">
      <mat-icon style="cursor:pointer;" (click)="openMediaDialog(patientForm)">add_photo_alternate</mat-icon>
      <mat-icon style="cursor:pointer;" (click)="printEmergencyCard(patientForm)">print</mat-icon>
    </div>
    <button class="deletePatientButton" type="button"  (click)="deletePatient($event, patientIndex)" mat-mini-fab color="warn">
      <mat-icon>delete</mat-icon>
  </button>
</div>


<form [formGroup]="dropdownForm" fxLayout="column" fxLayoutAlign="center center">

	<mat-form-field>
		<mat-select placeholder="Select dropdown"
			formControlName="currentDropdown">
			<mat-option>None</mat-option>
			<mat-option *ngFor="let dropdown of (dropdowns | async); let i = index;" [value]="dropdown">
				{{ dropdown.displayName }}
			</mat-option>
		</mat-select>
	</mat-form-field>

	<div class="progress-wrapper">
		<mat-progress-bar mode="indeterminate" *ngIf="(refreshing | async)" style="margin:0 auto;"></mat-progress-bar>
	</div>

<fieldset class="form-sub-group" style="width: 95%;" *ngIf="currentDisplayName">
	<legend class="legend" i18n>{{currentDisplayName}}</legend>

<div>

	<div>

		<mat-form-field>
			<input matInput #filter (keyup)="applyFilter($any($event.target).value)" placeholder="Filter">
			<button mat-icon-button matSuffix aria-label="clear" *ngIf="filter.value" (click)="filter.value=''; applyFilter('');">
				<mat-icon>close</mat-icon>
			</button>
		</mat-form-field>

	</div>

	<div class="add-button-container">
		<button color="primary" mat-raised-button (click)="addData($event)">
		  Add data
		</button>
	</div>


	<mat-table #table [dataSource]="currentDropdownDataSource"
	cdkDropList
	[cdkDropListData]="(currentDropdownDataSource | async)!"
	(cdkDropListDropped)="dropTable($event)">

		<ng-container matColumnDef="value">
			<mat-header-cell *matHeaderCellDef> {{currentDisplayName}} </mat-header-cell>
			<mat-cell *matCellDef="let element" [formGroup]="element">
				<mat-form-field floatLabel="never">
					<input  matInput placeholder="value" formControlName="value">

				</mat-form-field>
			</mat-cell>
		</ng-container>

		<ng-container matColumnDef="sort">
			<mat-header-cell *matHeaderCellDef> Sort order </mat-header-cell>
			<mat-cell *matCellDef="let element; let index = index" [formGroup]="element">
				<mat-form-field  floatLabel="never" style="width:45%;">
					<mat-select  formControlName="sort" placeholder="Sort order">
						<mat-option>None</mat-option>
						<mat-option *ngFor="let x of (currentDropdownDataSource | async); let i = index;" [value]="i+1">
							{{ i + 1 }}
						</mat-option>
					</mat-select>
					<mat-error  *ngIf="element.get('sort')?.hasError('uniqueBy')">
						Sort order should be unique
					</mat-error>
				</mat-form-field>
			</mat-cell>
		</ng-container>

		<ng-container matColumnDef="isDeleted" style="overflow: display;">
			<mat-header-cell *matHeaderCellDef> Disabled </mat-header-cell>
			<mat-cell style="overflow:visible;" *matCellDef="let element; let i = index;"  [formGroup]="element">
				<mat-checkbox  formControlName="isDeleted" (change)='setUpdatable(i,$event)'> {{element.get('isDeleted')?.value ? 'disabled' : 'enabled' }}</mat-checkbox>
			</mat-cell>
		</ng-container>

		<ng-container matColumnDef="actions">
			<mat-header-cell  *matHeaderCellDef > Actions </mat-header-cell>
			<mat-cell *matCellDef="let element;let i = index" [formGroup]="element" >

				<button
				*ngIf="!element.disabled"
				mat-mini-fab
				color="primary"
				[disabled]="(currentDropdownDataSource | async)?.values?.length === 1"
				(click)="saveRow(i,$event)">
					<mat-icon>save</mat-icon>
				</button>

				<button
				*ngIf="element.disabled"
				mat-mini-fab
				color="primary"
				[disabled]="(currentDropdownDataSource | async)?.values?.length === 1"
				(click)="editRow(i,$event)">
					<mat-icon>edit</mat-icon>
				</button>

				<button
				style="margin-left: 1em;"
				mat-mini-fab
				color="warn"
				[disabled]="(currentDropdownDataSource | async)?.values?.length === 1"
				(click)="removeData($event,i)">
					<mat-icon>delete</mat-icon>
				</button>

			</mat-cell>
		</ng-container>

		<ng-container matColumnDef="saving">
			<th mat-header-cell *matHeaderCellDef> No. </th>
			<td mat-cell *matCellDef="let element" [formGroup]="element">

			</td>
		  </ng-container>

		<ng-container matColumnDef="position">
			<th mat-header-cell *matHeaderCellDef> No. </th>
			<td mat-cell *matCellDef="let element">
			  <mat-icon style="pointer-events: all; cursor: move;" cdkDragHandle>reorder</mat-icon>
			</td>
		  </ng-container>

		<mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
		<mat-row *matRowDef="let row; columns: displayedColumns;"  cdkDrag [cdkDragData]="row"></mat-row>
	</mat-table>
</div>


</fieldset>

</form>